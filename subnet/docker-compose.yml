version: "3.7"

services:
  puppeth:
    image: xinfinorg/xdcsubnets:latest
    entrypoint: ["puppeth"]
    volumes:
      - "./puppeth:/root/.puppeth"
  subnet1:
    # image: xinfinorg/xdcsubnets:latest    
    image: localbuild-subnet:latest #use localbuild, subnet public img not updated
    volumes:
      - "./xdcchain1:/work/xdcchain"
      - "../../xinfin-script/setup-envs/subnet/genesis.json:/work/genesis.json"
    restart: "always"
    env_file: "../../xinfin-script/setup-envs/subnet/subnet-1.env"
    network_mode: "host" 
    # ports:
    #   - "30303:30303"
    #   - "8545:8545"
    #   - "8555:8555"
  subnet2:
    # image: xinfinorg/xdcsubnets:latest    
    image: localbuild-subnet:latest #use localbuild, subnet public img not updated
    volumes:
      - "./xdcchain2:/work/xdcchain"
      - "../../xinfin-script/setup-envs/subnet/genesis.json:/work/genesis.json"
    restart: "always"
    env_file: "../../xinfin-script/setup-envs/subnet/subnet-2.env"
    network_mode: "host" 
    # ports:
    #   - "30304:30304"
    #   - "8546:8546"
    #   - "8556:8556"
  subnet3:
    # image: xinfinorg/xdcsubnets:latest    
    image: localbuild-subnet:latest #use localbuild, subnet public img not updated
    volumes:
      - "./xdcchain3:/work/xdcchain"
      - "../../xinfin-script/setup-envs/subnet/genesis.json:/work/genesis.json"
    restart: "always"
    env_file: "../../xinfin-script/setup-envs/subnet/subnet-3.env"
    network_mode: "host" 
    # ports:
    #   - "30305:30305"
    #   - "8547:8547"
    #   - "8557:8557"
  subnet4:
    # image: xinfinorg/xdcsubnets:latest    
    image: localbuild-subnet:latest #use localbuild, subnet public img not updated
    volumes:
      - "./xdcchain4:/work/xdcchain"
      - "../../xinfin-script/setup-envs/subnet/genesis.json:/work/genesis.json"
    restart: "always"
    env_file: "../../xinfin-script/setup-envs/subnet/subnet-4.env"
    network_mode: "host" 
    # ports:
    #   - "30306:30306"
    #   - "8548:8548"
    #   - "8558:8558"
  subnet5:
    # image: xinfinorg/xdcsubnets:latest    
    image: localbuild-subnet:latest #use localbuild, subnet public img not updated
    volumes:
      - "./xdcchain5:/work/xdcchain"
      - "../../xinfin-script/setup-envs/subnet/genesis.json:/work/genesis.json"
    restart: "always"
    env_file: "../../xinfin-script/setup-envs/subnet/subnet-5.env"
    network_mode: "host" 
    # ports:
    #   - "30307:30307"
    #   - "8549:8549"
    #   - "8559:8559"
  bootnode:
    image: xinfinorg/xdcsubnets:latest
    restart: "always"
    env_file: "../../xinfin-script/setup-envs/subnet/bootnode.env"
    volumes:
      - "./bootnodes:/work/bootnodes"
    entrypoint: ["bash","/work/start-bootnode.sh"]
    command: ["-verbosity", "6", "-nodekey", "bootnode.key", "--addr", ":30301"]
    ports:
      - "30301:30301/tcp"
      - "30301:30301/udp"
  stats:
    image: xinfinorg/subnet-stats-service:latest
    restart: "always"
    env_file: "../../xinfin-script/setup-envs/subnet/stats-service.env"
    volumes:
      - "./stats-service/logs:/app/logs"
    ports:
      - "3000:3000"
  relayer:
    image: xinfinorg/xdc-relayer:latest
    restart: "always"
    env_file: "../../xinfin-script/setup-envs/subnet/relayer.env"
  # mainnet:
  #   image: xinfinorg/devnet:latest
  #   volumes:
  #     - "./xdcchain_mainnet:/work/xdcchain"
  #   restart: "always"
  #   environment:
  #     NODE_NAME: ${PARENTCHAIN_NODE_NAME}
  #     LOG_LEVEL: ${LOG_LEVEL}
  #   ports:
  #     - "40313:30303"
  #     - "9555:8545"
  #     - "9565:8555"